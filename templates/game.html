{% extends "base.html" %}

{% block content %}
<nav class="user-nav">
    <div class="logo">{% if is_admin %}ğŸ® Admin Test Game{% else %}ğŸ° Roulette Game{% endif %}</div>
    {% if is_admin %}
    <a href="{{ url_for('admin') }}" class="logout-btn">â† Back to Admin Panel</a>
    {% else %}
    <a href="{{ url_for('home') }}" class="logout-btn">â† Back to Game</a>
    {% endif %}
</nav>

<div class="game-container">
    <h2>Roulette (0-12)</h2>
    
    <div class="wheel-result" id="result-display">
        Spin
    </div>

    <div class="betting-board">
        <div class="numbers-grid">
            <button class="bet-btn number green" onclick="placeBet('number', 0)">0</button>
            <!-- Row 1 -->
            <button class="bet-btn number red" onclick="placeBet('number', 1)">1</button>
            <button class="bet-btn number black" onclick="placeBet('number', 2)">2</button>
            <button class="bet-btn number red" onclick="placeBet('number', 3)">3</button>
            <button class="bet-btn number black" onclick="placeBet('number', 4)">4</button>
            <button class="bet-btn number red" onclick="placeBet('number', 5)">5</button>
            <button class="bet-btn number black" onclick="placeBet('number', 6)">6</button>
            <!-- Row 2 -->
            <button class="bet-btn number red" onclick="placeBet('number', 7)">7</button>
            <button class="bet-btn number black" onclick="placeBet('number', 8)">8</button>
            <button class="bet-btn number red" onclick="placeBet('number', 9)">9</button>
            <button class="bet-btn number black" onclick="placeBet('number', 10)">10</button>
            <button class="bet-btn number red" onclick="placeBet('number', 11)">11</button>
            <button class="bet-btn number black" onclick="placeBet('number', 12)">12</button>
        </div>

        <div class="outside-bets">
            <button class="bet-btn red-bet" onclick="placeBet('color', 'red')">ğŸ”´ RED</button>
            <button class="bet-btn black-bet" onclick="placeBet('color', 'black')">âš« BLACK</button>
            <button class="bet-btn even-bet" onclick="placeBet('parity', 'even')"> EVEN</button>
            <button class="bet-btn odd-bet" onclick="placeBet('parity', 'odd')"> ODD</button>
        </div>
    </div>

    <div class="controls">
        <label>Bet Amount: <input type="number" id="bet-amount" value="10" min="1"></label>
        <div id="current-bet">No bet selected</div>
        <button id="spin-btn" onclick="spinWheel()" disabled>SPIN</button>
    </div>
</div>

<script>
    let currentBetType = null;
    let currentBetValue = null;

    function placeBet(type, value) {
        currentBetType = type;
        currentBetValue = value;
        document.getElementById('current-bet').innerText = `Selected Bet: ${type.toUpperCase()} ${value}`;
        document.getElementById('spin-btn').disabled = false;
        
        // Highlight selected
        document.querySelectorAll('.bet-btn').forEach(btn => btn.classList.remove('selected'));
        event.target.classList.add('selected');
    }

    async function spinWheel() {
        const amount = document.getElementById('bet-amount').value;
        if (!currentBetType || amount <= 0) return;

        const btn = document.getElementById('spin-btn');
        btn.disabled = true;
        btn.innerText = 'Spinning...';

        try {
            const response = await fetch('/spin', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    bet_type: currentBetType,
                    bet_value: currentBetValue,
                    bet_amount: amount
                })
            });
            
            const data = await response.json();
            
            if (data.error) {
                alert(data.error);
            } else {
                const resultDiv = document.getElementById('result-display');
                resultDiv.innerText = `${data.outcome_number} (${data.outcome_color.toUpperCase()})`;
                resultDiv.className = `wheel-result ${data.outcome_color}`;
                
                if (data.payout > 0) {
                    alert(`You Won $${data.payout}!`);
                } else {
                    // alert('You Lost!');
                }
                
                // Reload to update balance (or update via JS)
                setTimeout(() => location.reload(), 1500);
            }
        } catch (e) {
            console.error(e);
            alert('Error spinning wheel');
        }
        
        btn.disabled = false;
        btn.innerText = 'SPIN';
    }
</script>
{% endblock %}
